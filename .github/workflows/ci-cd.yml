name: Minimal CI Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  # ===== Job 1: í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸ =====
  check-structure:
    name: í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸
    runs-on: ubuntu-latest
    
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
      
      - name: í”„ë¡œì íŠ¸ í´ë” í™•ì¸
        run: |
          echo "ğŸ“ í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°:"
          ls -la
          
      - name: ìƒì„¸ êµ¬ì¡° ì¶œë ¥
        run: |
          echo ""
          echo "ğŸ“‚ í´ë” êµ¬ì¡°:"
          find . -type d -not -path '*/\.*' | sort
          
      - name: í•„ìˆ˜ í´ë” ì²´í¬
        run: |
          echo ""
          echo "âœ… í•„ìˆ˜ í´ë” í™•ì¸:"
          
          [ -d "airflow" ] && echo "âœ… airflow/" || echo "âŒ airflow/"
          [ -d "api" ] && echo "âœ… api/" || echo "âŒ api/"
          [ -d "data" ] && echo "âœ… data/" || echo "âŒ data/"
          [ -d ".github/workflows" ] && echo "âœ… .github/workflows/" || echo "âŒ .github/workflows/"

  # ===== Job 2: README í™•ì¸ =====
  check-readme:
    name: README íŒŒì¼ í™•ì¸
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
      
      - name: ë©”ì¸ README í™•ì¸
        run: |
          if [ -f "README.md" ]; then
            echo "âœ… README.md íŒŒì¼ ì¡´ì¬"
            echo ""
            echo "ğŸ“„ README.md ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°:"
            head -n 15 README.md
          else
            echo "âŒ README.md íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi

  # ===== Job 3: Python í™˜ê²½ í…ŒìŠ¤íŠ¸ =====
  test-python-setup:
    name: Python í™˜ê²½ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
      
      - name: Python ë²„ì „ í™•ì¸
        run: |
          echo "ğŸ Python ë²„ì „:"
          python --version
          echo ""
          echo "ğŸ“¦ pip ë²„ì „:"
          pip --version
      
      - name: ê°„ë‹¨í•œ Python ì½”ë“œ ì‹¤í–‰
        run: |
          echo ""
          echo "âœ… Python ì‹¤í–‰ í…ŒìŠ¤íŠ¸:"
          python -c "print('Hello from GitHub Actions!')"
          python -c "import sys; print(f'Python path: {sys.executable}')"

  # ===== Job 4: íŒŒì¼ ì¡´ì¬ í™•ì¸ =====
  check-files:
    name: ì£¼ìš” íŒŒì¼ í™•ì¸
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
      
      - name: íŒŒì¼ ëª©ë¡ í™•ì¸
        run: |
          echo "ğŸ“„ í”„ë¡œì íŠ¸ íŒŒì¼ë“¤:"
          find . -type f -not -path '*/\.*' | head -20
          
      - name: Python íŒŒì¼ ì°¾ê¸°
        run: |
          echo ""
          echo "ğŸ Python íŒŒì¼ ê²€ìƒ‰:"
          if find . -name "*.py" -not -path '*/\.*' | grep -q .; then
            echo "âœ… Python íŒŒì¼ ë°œê²¬:"
            find . -name "*.py" -not -path '*/\.*'
          else
            echo "âš ï¸ Python íŒŒì¼ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤ (ë‚˜ì¤‘ì— ì¶”ê°€ ì˜ˆì •)"
          fi
      
      - name: YAML íŒŒì¼ ì°¾ê¸°
        run: |
          echo ""
          echo "ğŸ“ YAML íŒŒì¼ ê²€ìƒ‰:"
          if find . -name "*.yml" -o -name "*.yaml" | grep -q .; then
            echo "âœ… YAML íŒŒì¼ ë°œê²¬:"
            find . -name "*.yml" -o -name "*.yaml"
          else
            echo "âš ï¸ YAML íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
          fi

  # ===== Job 5: Git ì •ë³´ í™•ì¸ =====
  check-git-info:
    name: Git ì •ë³´ í™•ì¸
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
      
      - name: Git ì •ë³´ ì¶œë ¥
        run: |
          echo "ğŸ“Œ Git ì •ë³´:"
          echo "ë¸Œëœì¹˜: ${{ github.ref }}"
          echo "ì»¤ë°‹ SHA: ${{ github.sha }}"
          echo "ì´ë²¤íŠ¸: ${{ github.event_name }}"
          echo "ì‘ì„±ì: ${{ github.actor }}"
          echo ""
          echo "ğŸ“ ìµœê·¼ ì»¤ë°‹:"
          git log -1 --pretty=format:"%h - %an, %ar : %s"

  # ===== Job 6: í™˜ê²½ ì •ë³´ =====
  check-environment:
    name: ì‹¤í–‰ í™˜ê²½ ì •ë³´
    runs-on: ubuntu-latest
    
    steps:
      - name: ì‹œìŠ¤í…œ ì •ë³´
        run: |
          echo "ğŸ’» ì‹¤í–‰ í™˜ê²½:"
          echo "OS: $(uname -s)"
          echo "ì»¤ë„: $(uname -r)"
          echo "ì•„í‚¤í…ì²˜: $(uname -m)"
          echo ""
          echo "ğŸ“Š ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤:"
          echo "CPU: $(nproc) cores"
          echo "ë©”ëª¨ë¦¬: $(free -h | awk '/^Mem:/ {print $2}')"
          echo ""
          echo "â° í˜„ì¬ ì‹œê°:"
          date

  # ===== Job 7: ì„±ê³µ ë©”ì‹œì§€ =====
  success:
    name: âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ
    runs-on: ubuntu-latest
    needs: [check-structure, check-readme, test-python-setup, check-files, check-git-info, check-environment]
    
    steps:
      - name: ì„±ê³µ ë©”ì‹œì§€
        run: |
          echo "ğŸ‰ğŸ‰ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! ğŸ‰ğŸ‰ğŸ‰"
          echo ""
          echo "âœ… ì™„ë£Œëœ ê²€ì‚¬:"
          echo "  - í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸"
          echo "  - README íŒŒì¼ í™•ì¸"
          echo "  - Python í™˜ê²½ í…ŒìŠ¤íŠ¸"
          echo "  - íŒŒì¼ ì¡´ì¬ í™•ì¸"
          echo "  - Git ì •ë³´ í™•ì¸"
          echo "  - ì‹¤í–‰ í™˜ê²½ í™•ì¸"
          echo ""
          echo "ğŸš€ GitHub Actionsê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!"
          echo ""
